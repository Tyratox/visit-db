<%- include('../header') -%>
	<div class="container">
		<h2>
			Visite #<%= visit.id %>
			<small>
				(<a href="/?visit_id=<%= visit.id%>">bearbeiten</a>)
				(<a class="text-danger" href="/delete/visit/<%= visit.id%>">löschen</a>)
			</small>
		</h2>
		<div class="table-responsive">
			<table class="table table-striped table-bordered">
				<tbody>
					<tr>
						<td>ID</td>
						<td><%= visit.id %></td>
					</tr>
					<tr>
						<td>Typ</td>
						<td><%= visit.visit_type_name %></td>
					</tr>
					<tr>
						<td>Datum</td>
						<td>
							<%= visit.date %>
						</td>
					</tr>
					<tr>
						<td>Wer</td>
						<td><%= visit.username %></td>
					</tr>
					<tr>
						<td>Dauer</td>
						<td><%= visit.duration %> Minuten</td>
					</tr>
					<tr>
						<td>Besuchte Patienten</td>
						<td><%= visit.patient_count %></td>
					</tr>
					<tr>
						<td>Spital</td>
						<td><%= visit.hospital_name %></td>
					</tr>
					<tr>
						<td>Disziplin</td>
						<td><%= visit.discipline_name %></td>
					</tr>
					<tr>
						<td>Station</td>
						<td><%= visit.station_name %></td>
					</tr>
				</tbody>
			</table>
			<div class="row">
				<%-
					patients.map(({
						id,
						patient_number,
						date_of_birth,
						gender,
						atc_code,
						substance_name,
						case_number,
						case_type_abbreviation,
						case_type_name,
						fields
					}) => {
						return `
							<div class="col-12 col-md-6">
								<h4>Patientendaten</h4>
								<div class="table-responsive">
									<table class="table table-striped table-bordered">
										<tr>
											<td>Falltyp</td>
											<td>${case_type_name} (${case_type_abbreviation})</td>
										</tr>
										<tr>
											<td>Wirkstoff (ATC-Code)</td>
											<td>${substance_name ? substance_name : ""} ${atc_code ? "("+atc_code+")" : "-"}</td>
										</tr>
										<tr>
											<td>Geburtsdatum</td>
											<td>${date_of_birth}</td>
										</tr>
										<tr>
											<td>Geschlecht</td>
											<td>${gender === "male" ? "männlich" : "weiblich"}</td>
										</tr>
										<tr>
											<td>Falltyp</td>
											<td>
												${case_type_name} (${case_type_abbreviation})
											</td>
										</tr>
										<tr>
											<td>Fallnummer</td>
											<td>
												${case_number}
											</td>
										</tr>
										<tr>
											<td>Patientennummer</td>
											<td>${patient_number ? patient_number : "-"}</td>
										</tr>
										<tr>
											<td>Aktionen</td>
											<td>
												<div class="pb-2">
													<a href="/add-patient/${visit.id}?patient_id=${id}">Patient bearbeiten</a>
												</div>
												<div>
													<a class="text-danger" href="/delete/patient/${id}">Patient löschen</a>
												</div>
											</td>
										</tr>
									</table>
								</div>
							</div>
							<div class="col-12 col-md-6">
								<h4 style="visibility:hidden">-</h4>
								<!-- not proud of this -->
								<div class="table-responsive">
									<table class="table table-striped table-bordered">
										${fields.map(({title, content}) => {
											return `
												<tr>
													<td>${title}</td>
													<td>${content}</td>
												</tr>
											`;
										}).join("")}
									</table>
								</div>
							</div>
						`;
					}).join("");
				%>
				<div class="col-12" style="margin-bottom: 1rem;">
					<a class="btn btn-primary" href="/add-patient/<%= visit.id %>">Patient hinzufügen</a>
				</div>
			</div>
		</div>
	</div>
<%- include('../footer') -%>