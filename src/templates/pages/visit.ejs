<%- include('../header') -%>
	<div class="container">
		<h2>
			Visite #<%= visit.id %>
		</h2>
		<div class="table-responsive">
			<table class="table table-striped table-bordered">
				<tbody>
					<tr>
						<td>ID</td>
						<td><%= visit.id %></td>
					</tr>
					<tr>
						<td>Typ</td>
						<td><%= visit.visit_type_name %></td>
					</tr>
					<tr>
						<td>Datum</td>
						<td>
							<%
								let d = new Date(visit.date*1000),
								    date = d.getDate() + "." + 
									(d.getMonth() + 1) + "." + 
									d.getFullYear();
							%>
							<%= date %>
						</td>
					</tr>
					<tr>
						<td>Wer</td>
						<td><%= visit.username %></td>
					</tr>
					<tr>
						<td>Dauer</td>
						<td><%= visit.duration %> Minuten</td>
					</tr>
					<tr>
						<td>Besuchte Patienten</td>
						<td><%= visit.patient_count %></td>
					</tr>
					<tr>
						<td>Spital</td>
						<td><%= visit.hospital_name %></td>
					</tr>
					<tr>
						<td>Disziplin</td>
						<td><%= visit.discipline_name %></td>
					</tr>
					<tr>
						<td>Station</td>
						<td><%= visit.station_name %></td>
					</tr>
				</tbody>
			</table>
			<div class="row">
				<%-
					patients.map(({
						patient_number,
						date_of_birth,
						gender,
						atc_code,
						substance_name,
						case_number,
						case_type_abbreviation,
						case_type_name,
						fields
					}) => {
						return `
							<div class="col-12 col-md-6">
								<h4>Patientendaten</h4>
								<div class="table-responsive">
									<table class="table table-striped table-bordered">
										<tr>
											<td>Falltyp</td>
											<td>${case_type_name} (${case_type_abbreviation})</td>
										</tr>
										<tr>
											<td>Wirkstoff (ATC-Code)</td>
											<td>${substance_name} (${atc_code})</td>
										</tr>
										<tr>
											<td>Geburtsdatum</td>
											<td>${date_of_birth}</td>
										</tr>
										<tr>
											<td>Geschlecht</td>
											<td>${gender === "male" ? "m√§nnlich" : "weiblich"}</td>
										</tr>
										<tr>
											<td>Fallnummer</td>
											<td>${case_number}</td>
										</tr>
										<tr>
											<td>Patientennummer</td>
											<td>${patient_number}</td>
										</tr>
									</table>
								</div>
							</div>
							<div class="col-12 col-md-6">
								<h4>Eigene Felder</h4>
								<div class="table-responsive">
									<table class="table table-striped table-bordered">
										${fields.map(({title, content}) => {
											return `
												<tr>
													<td>${title}</td>
													<td>${content}</td>
												</tr>
											`;
										}).join("")}
									</table>
								</div>
							</div>
						`;
					});
				%>
			</div>
		</div>
	</div>
<%- include('../footer') -%>